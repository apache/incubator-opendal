---
title: Prometheus
---

# Introduction to Prometheus

Prometheus is an open-source monitoring and alerting toolkit that is widely used for collecting and analyzing time-series data. It provides a flexible and powerful platform for monitoring various aspects of your applications and infrastructure.

For more detailed information about Prometheus, you can refer to the [official Prometheus website](https://prometheus.io/).

# Prometheus Metrics

In this section, we will introduce three metrics that are currently being exported by our project. These metrics are essential for understanding the behavior and performance of our applications.

| Metric Name             | Type     | Description                                       | Labels              |
|-------------------------|----------|---------------------------------------------------|---------------------|
| requests_total          | Counter  | Total times of 'create' operation being called   | scheme, operation   |
| requests_duration_seconds | Histogram | Histogram of the time spent on specific operation | scheme, operation   |
| bytes_total             | Histogram | Total size                                        | scheme, operation   |

For a more detailed explanation of these metrics and how they are used, please refer to the [Prometheus documentation](https://prometheus.io/docs/introduction/overview/).

# Histogram Configuration

In this section, we will provide information about the configuration of the histograms used in our project. The metric buckets for these histograms are automatically generated based on the `exponential_buckets(0.01, 2.0, 16)` configuration.

Prometheus histograms allow us to observe the distribution of values over time. The `exponential_buckets` function generates bucket boundaries that are exponentially spaced. This is useful for capturing data that can have a wide range of values.

For more details on configuring histograms in Prometheus, you can explore the [official Prometheus documentation](https://prometheus.io/docs/practices/histograms/).

This concludes our introduction to Prometheus metrics and configuration. For further information and in-depth documentation, please visit the [Prometheus official website](https://prometheus.io/).

# Code Example

```rust
use log::debug;
use log::info;
use opendal::layers::PrometheusLayer;
use opendal::services;
use opendal::Operator;
use opendal::Result;
use prometheus::Encoder;


#[tokio::main]
async fn main() -> Result<()> {
    let builder = services::Memory::default();
    let registry = prometheus::default_registry();
    let buckets=vec![0.001, 0.01, 0.1, 1.0, 10.0, 100.0, 1000.];
    let buckets2 = vec![0.001, 0.01, 0.1, 1.0, 10.0, 100.0, 1000.];
    let op = Operator::new(builder)
        .expect("must init")
        .layer(PrometheusLayer::with_registry(registry.clone()).requests_duration_seconds_buckets(buckets).bytes_total_buckets(buckets2))
        .finish();
    debug!("operator: {op:?}");
    op.write("test", "Hello, World!").await?;
    // Read data from object.
    let bs = op.read("test").await?;
    info!("content: {}", String::from_utf8_lossy(&bs));
    // Get object metadata.
    let meta = op.stat("test").await?;
    info!("meta: {:?}", meta);
    // Export prometheus metrics.
    let mut buffer = Vec::<u8>::new();
    let encoder = prometheus::TextEncoder::new();
    encoder.encode(&prometheus::gather(), &mut buffer).unwrap();
    println!("## Prometheus Metrics");
    println!("{}", String::from_utf8(buffer.clone()).unwrap());
    Ok(())
}
```